# Руководство по навигации читалки

## Текущая реализация навигации

Сайт имеет несколько способов листания страниц в режиме чтения.

### 1. **Клик на страницу (Primary Method)**
- **Левая половина** экрана → **Предыдущая страница**
- **Правая половина** экрана → **Следующая страница**

**Как это работает:**
- В компоненте `Book.tsx` функция `handlePageClick` отслеживает клики на контейнер с книгой
- Функция проверяет, где произошёл клик, и определяет половину экрана
- Автоматически исключает клики на интерактивные элементы (кнопки, ссылки, текст содержания)

**Исключения (НЕ срабатывает навигация):**
- Клик на **ссылки** (`<a>`)
- Клик на **кнопки** (`<button>`)
- Клик на **текстовые поля** (`<input>`, `<textarea>`)
- Клик на **содержание** (`.toc`, `.table-of-contents`)
- Клик на **эпиграфы** (`.epigraph`)
- Клик на **меню** (`<nav>`, `.menu`)
- Клик на **выделенный текст** (при копировании)
- Элементы с атрибутом `[data-no-flip]`

**Визуальная обратная связь:**
- На **десктопе**: курсор `pointer` показывает интерактивность
- На **мобильных**: курсор `grab` / `grabbing` показывает возможность взаимодействия

---

### 2. **Smart Edge Click (15% от края)**
Дополнительный способ навигации через хук `useEdgeClickNavigation`:
- Клик в **левый край** (15% от ширины) → **Предыдущая страница**
- Клик в **правый край** (15% от ширины) → **Следующая страница**

**Где используется:**
- В компоненте `Book.tsx` активирован хук `useEdgeClickNavigation`
- Работает только когда книга открыта (`enabled: isBookOpen`)
- Имеет ту же защиту от клика на интерактивные элементы

---

### 3. **Ползунок прогресса**
Внизу страницы находится ползунок для быстрого перемещения:
- Можно нажать на любую точку ползунка для перемотки
- Показывает текущую страницу и процент прочитанного
- Стиль: золотистый с коричневым фоном

**Элементы управления на ползунке:**
- Кнопка "В начало" → первая страница
- Кнопка "Середина" → середина книги
- Кнопка "В конец" → последняя страница

---

### 4. **Боковое меню**
Меню в правом верхнем углу:
- Показывает все главы и стихи
- Можно кликнуть на любую главу или стих для быстрого перехода
- Показывает активную главу/стих при чтении
- На мобильных раскрывается на весь экран

---

### 5. **Кнопки "Назад" и "Вперёд" (Дополнительно)**
В боковом меню есть быстрые кнопки для навигации между главами и стихами.

---

## Файлы навигации

### Основные компоненты:

1. **`src/components/Book/Book.tsx`**
   - Главный компонент чтения
   - Функция `handlePageClick` для перелистывания по клику
   - Интеграция хука `useEdgeClickNavigation`
   - Управление состоянием книги (`isBookOpen`, `currentPage`)

2. **`src/hooks/useEdgeClickNavigation.ts`**
   - Хук для обработки кликов на края экрана
   - Smart detection для исключения интерактивных элементов
   - Полностью типизирован на TypeScript

3. **`src/components/Book/EdgeNavigationHints.tsx`**
   - Визуальные подсказки со стрелками (в данный момент отключены)
   - Можно включить обратно, если нужны дополнительные визуальные подсказки

4. **`src/components/Book/SidebarNav.tsx`**
   - Боковое меню с навигацией по главам и стихам
   - Отображает активную страницу

5. **`src/styles/globals.css`**
   - Стили для навигационных элементов
   - Класс `.book-interactive-container` для курсора

---

## Логика работы `handlePageClick`

```typescript
const handlePageClick = (e: React.MouseEvent<HTMLDivElement>) => {
  const target = e.target as HTMLElement;
  
  // Шаг 1: Проверяем стандартные интерактивные элементы
  if (target.tagName === 'BUTTON' || target.tagName === 'A' || ...) {
    return; // Не навигируем
  }
  
  // Шаг 2: Проверяем специальные классы и атрибуты
  if (target.closest('[data-no-flip]') || target.closest('.toc') || ...) {
    return; // Не навигируем
  }
  
  // Шаг 3: Проверяем выделенный текст
  if (window.getSelection()?.toString()) {
    return; // Пользователь выделяет текст, не навигируем
  }

  // Шаг 4: Определяем зону клика
  const container = e.currentTarget;
  const clickX = e.clientX - container.getBoundingClientRect().left;
  const containerWidth = container.getBoundingClientRect().width;
  
  // Шаг 5: Навигируем
  if (clickX > containerWidth * 0.5) {
    handleNextPage();  // Правая половина
  } else {
    handlePrevPage();  // Левая половина
  }
};
```

---

## Тестирование

### На десктопе:
- ✅ Клик левой половины → предыдущая страница
- ✅ Клик правой половины → следующая страница
- ✅ Курсор меняется на `pointer`
- ✅ Клик на содержание → НЕ переводит страницу

### На мобильных:
- ✅ Навигация работает так же
- ✅ Курсор `grab` / `grabbing` показывает взаимодействие
- ✅ Большие кликабельные зоны для пальца

### Исключения:
- ✅ Клик на ссылку → переход, не листание
- ✅ Клик на кнопку → нажатие, не листание
- ✅ Выделение текста → копирование, не листание

---

## Включение/Отключение EdgeNavigationHints

Если нужны визуальные стрелки по краям:

**Включить (раскомментировать в `Book.tsx`):**
```typescript
{isBookOpen && (
  <EdgeNavigationHints
    edgePercentage={15}
    visible={isBookOpen}
    hideDelay={3000}
    onNextPage={handleNextPage}
    onPrevPage={handlePrevPage}
  />
)}
```

**Отключить (закомментировать):**
```typescript
{/* isBookOpen && (
  <EdgeNavigationHints {...}
) */}
```

---

## Производительность

- ✅ **Оптимизирована** для всех разрешений экрана
- ✅ **Типизирована** на TypeScript (0 ошибок)
- ✅ **Протестирована** на десктопе и мобильных
- ✅ **Готова** к деплою на Vercel

---

## Возможные улучшения в будущем

1. Добавить **клавиатурную навигацию** (стрелки ←→)
2. Добавить **жест свайп** на мобильных
3. Добавить **закладки** для сохранения позиции
4. Добавить **поиск** по тексту
5. Добавить **размер шрифта** (масштабирование)

---

**Дата создания:** 2026-01-24  
**Версия:** 1.0  
**Статус:** Готово к использованию ✅
